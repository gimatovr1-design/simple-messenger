<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Simple Messenger</title>

<style>
* { box-sizing: border-box; }

body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: linear-gradient(120deg,#0f2027,#203a43,#2c5364);
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
}

.chat-wrapper {
    width: 900px;
    height: 550px;
    display: flex;
    background: rgba(0,0,0,0.55);
    border-radius: 12px;
    overflow: hidden;
    color: white;
}

/* ===== ONLINE ===== */
.online {
    width: 200px;
    background: rgba(0,0,0,0.4);
    padding: 10px;
}

.online h3 {
    margin: 5px 0 10px;
}

.user {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 6px;
}

.dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: #00ff6a;
}

/* ===== CHAT ===== */
.chat {
    flex: 1;
    display: flex;
    flex-direction: column;
}

.messages {
    flex: 1;
    padding: 15px;
    overflow-y: auto;
}

.msg {
    max-width: 60%;
    margin-bottom: 10px;
    padding: 8px 12px;
    border-radius: 12px;
    animation: fade .2s;
}

.me {
    background: #7b2cff;
    margin-left: auto;
}

.other {
    background: #444;
    margin-right: auto;
}

.msg img, .msg video {
    max-width: 100%;
    border-radius: 8px;
    margin-top: 5px;
}

/* ===== INPUT ===== */
.input-area {
    display: flex;
    padding: 10px;
    gap: 5px;
}

.input-area input[type=text] {
    flex: 1;
    padding: 8px;
    border-radius: 6px;
    border: none;
}

button {
    border: none;
    padding: 8px 10px;
    border-radius: 6px;
    cursor: pointer;
}

/* ===== EMOJI ===== */
.emoji-panel {
    position: absolute;
    bottom: 70px;
    background: #222;
    padding: 10px;
    border-radius: 8px;
    display: none;
    max-width: 300px;
}

.emoji-panel span {
    cursor: pointer;
    font-size: 22px;
    margin: 4px;
}

@keyframes fade {
    from { opacity: 0; transform: translateY(5px); }
    to { opacity: 1; }
}
</style>
</head>

<body>

<div class="chat-wrapper">
    <div class="online">
        <h3>ĞĞ½Ğ»Ğ°Ğ¹Ğ½</h3>
        <div id="users"></div>
    </div>

    <div class="chat">
        <div class="messages" id="messages"></div>

        <div class="input-area">
            <button onclick="toggleEmoji()">ğŸ˜€</button>
            <input type="file" id="file" hidden>
            <button onclick="document.getElementById('file').click()">ğŸ“</button>
            <input id="text" type="text" placeholder="Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ">
            <button onclick="sendText()">ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ</button>
        </div>
    </div>
</div>

<div class="emoji-panel" id="emoji">
ğŸ˜€ ğŸ˜ ğŸ˜‚ ğŸ¤£ ğŸ˜ ğŸ˜ ğŸ¤– ğŸ‘» ğŸ‰ ğŸ”¥ ğŸ’œ ğŸ’™ ğŸ’š â¤ï¸ ğŸ‘ ğŸ‘ ğŸ™ ğŸ’€  
</div>

<script>
const ws = new WebSocket(`ws://${location.host}/ws`);
let myNick = null;

ws.onmessage = e => {
    const data = JSON.parse(e.data);

    if (data.type === "users") {
        users.innerHTML = "";
        data.users.forEach(u => {
            users.innerHTML += `<div class="user"><div class="dot"></div>${u}</div>`;
        });
    }

    if (data.type === "message") {
        addMessage(data.nick, data);
    }
};

function addMessage(nick, data) {
    const div = document.createElement("div");
    div.className = "msg " + (nick === myNick ? "me" : "other");

    if (data.file) {
        if (data.file_type.startsWith("image")) {
            div.innerHTML = `<b>${nick}</b><br><img src="${data.file}">`;
        } else if (data.file_type.startsWith("video")) {
            div.innerHTML = `<b>${nick}</b><br><video controls src="${data.file}"></video>`;
        } else {
            div.innerHTML = `<b>${nick}</b><br><a href="${data.file}" download>ğŸ“ Ğ¤Ğ°Ğ¹Ğ»</a>`;
        }
    } else {
        div.innerHTML = `<b>${nick}</b><br>${data.text}`;
    }

    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
}

function sendText() {
    if (!text.value.trim()) return;
    ws.send(JSON.stringify({ text: text.value }));
    text.value = "";
}

file.onchange = () => {
    const f = file.files[0];
    const reader = new FileReader();
    reader.onload = () => {
        ws.send(JSON.stringify({
            file: reader.result,
            file_type: f.type
        }));
    };
    reader.readAsDataURL(f);
    file.value = "";
};

text.addEventListener("keydown", e => {
    if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendText();
    }
});

function toggleEmoji() {
    emoji.style.display = emoji.style.display === "block" ? "none" : "block";
}

emoji.onclick = e => {
    if (e.target.tagName === "SPAN" || e.target.nodeType === 3) {
        text.value += e.target.textContent;
    }
};
</script>

</body>
</html>

