<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Simple Messenger</title>

<style>
body {
    background: #111;
    color: #fff;
    font-family: Arial, sans-serif;
    display: flex;
    justify-content: center;
    margin-top: 40px;
}
#chat {
    width: 360px;
}
#messages {
    height: 300px;
    border: 1px solid #333;
    padding: 10px;
    overflow-y: auto;
    margin-bottom: 10px;
}
input, button {
    width: 100%;
    padding: 8px;
    margin-top: 5px;
}
#clearBtn {
    display: none;
    background: #b00020;
    color: white;
}
.system {
    color: #aaa;
    font-style: italic;
}
</style>
</head>
<body>

<div id="chat">
    <div id="messages"></div>

    <input id="nick" placeholder="–ù–∏–∫ (—Ä—É—Å–ª–∞–Ω –¥–ª—è –¥–æ—Å—Ç—É–ø–∞)" />
    <button onclick="setNick()">–°–º–µ–Ω–∏—Ç—å –Ω–∏–∫</button>

    <input id="text" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ" />
    <button onclick="sendMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>

    <button id="clearBtn">üßπ –û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç</button>
</div>

<script>
const ws = new WebSocket(`ws://${location.host}/ws`);
let myNick = "–ì–æ—Å—Ç—å";

const messagesDiv = document.getElementById("messages");
const clearBtn = document.getElementById("clearBtn");

ws.onmessage = (e) => {
    const data = JSON.parse(e.data);
    const div = document.createElement("div");

    if (data.type === "system") {
        div.className = "system";
        div.textContent = data.message;
    } else {
        div.textContent = `${data.nick}: ${data.text}`;
    }

    messagesDiv.appendChild(div);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
};

function setNick() {
    myNick = document.getElementById("nick").value || "–ì–æ—Å—Ç—å";

    ws.send(JSON.stringify({
        type: "nick",
        nick: myNick
    }));

    // –∫–Ω–æ–ø–∫–∞ –¢–û–õ–¨–ö–û –¥–ª—è —Ä—É—Å–ª–∞–Ω
    clearBtn.style.display = (myNick === "—Ä—É—Å–ª–∞–Ω") ? "block" : "none";
}

function sendMessage() {
    const text = document.getElementById("text").value;
    if (!text) return;

    ws.send(JSON.stringify({
        type: "message",
        text: text
    }));

    document.getElementById("text").value = "";
}

clearBtn.onclick = () => {
    if (!confirm("–û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç –¥–ª—è –≤—Å–µ—Ö?")) return;

    ws.send(JSON.stringify({
        type: "clear_chat"
    }));
};
</script>

</body>
</html>
