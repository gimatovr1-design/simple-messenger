<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Simple Messenger</title>

<style>
* { box-sizing: border-box; }

body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #111;
    color: #fff;
    display: flex;
    flex-direction: column;
    height: 100vh;
}

header {
    padding: 10px;
    background: #1a1a1a;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

#status {
    font-size: 14px;
}

#messages {
    flex: 1;
    padding: 10px;
    overflow-y: auto;
}

.message {
    margin-bottom: 6px;
    word-break: break-word;
}

.time {
    color: #777;
    font-size: 11px;
    margin-right: 6px;
}

.system {
    color: #888;
    font-style: italic;
}

footer {
    display: flex;
    padding: 10px;
    background: #1a1a1a;
}

input {
    flex: 1;
    padding: 8px;
    font-size: 16px;
    border: none;
    outline: none;
}

button {
    padding: 8px 14px;
    margin-left: 8px;
    font-size: 16px;
    cursor: pointer;
}

#notify {
    display: none;
    background: #ff4444;
    color: #000;
    padding: 6px;
    text-align: center;
    font-size: 14px;
}
</style>
</head>

<body>

<header>
    <div>üí¨ Simple Messenger</div>
    <div id="status">üî¥ offline</div>
</header>

<div id="notify">‚ö†Ô∏è –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ—Ç–µ—Ä—è–Ω–æ</div>

<div id="messages"></div>

<footer>
    <input id="input" type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." disabled>
    <button id="sendBtn" disabled>‚û§</button>
</footer>

<script>
let ws = null;
let reconnectTimer = null;

const statusEl = document.getElementById("status");
const input = document.getElementById("input");
const sendBtn = document.getElementById("sendBtn");
const messages = document.getElementById("messages");
const notify = document.getElementById("notify");

function now() {
    const d = new Date();
    return d.toLocaleTimeString("ru-RU", {
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit"
    });
}

function addMessage(text, cls = "") {
    const div = document.createElement("div");
    div.className = "message " + cls;

    const time = document.createElement("span");
    time.className = "time";
    time.textContent = now();

    const msg = document.createElement("span");
    msg.textContent = text;

    div.appendChild(time);
    div.appendChild(msg);

    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
}

function setOnline(state) {
    if (state) {
        statusEl.textContent = "üü¢ online";
        notify.style.display = "none";
        input.disabled = false;
        sendBtn.disabled = false;
        input.focus();
    } else {
        statusEl.textContent = "üî¥ offline";
        notify.style.display = "block";
        input.disabled = true;
        sendBtn.disabled = true;
    }
}

function connect() {
    ws = new WebSocket(
        (location.protocol === "https:" ? "wss://" : "ws://") +
        location.host + "/ws"
    );

    ws.onopen = () => {
        setOnline(true);
        addMessage("–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ", "system");
        clearTimeout(reconnectTimer);
    };

    ws.onmessage = (e) => {
        addMessage(e.data);
    };

    ws.onerror = () => {
        addMessage("–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è", "system");
    };

    ws.onclose = () => {
        setOnline(false);
        addMessage("–ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...", "system");
        reconnectTimer = setTimeout(connect, 2000);
    };
}

function sendMessage() {
    if (!ws || ws.readyState !== WebSocket.OPEN) return;

    const text = input.value.trim();
    if (!text) return;

    ws.send(text);
    input.value = "";
}

sendBtn.onclick = sendMessage;

input.addEventListener("keydown", e => {
    if (e.key === "Enter") sendMessage();
});

connect();
</script>

</body>
</html>
