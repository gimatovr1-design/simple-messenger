<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Simple Messenger</title>

<style>
* { box-sizing: border-box; }

body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #111;
    color: #fff;
    display: flex;
    flex-direction: column;
    height: 100vh;
}

header {
    padding: 10px;
    background: #1a1a1a;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

#status {
    font-size: 14px;
}

#messages {
    flex: 1;
    padding: 10px;
    overflow-y: auto;
}

.message {
    margin-bottom: 6px;
    word-break: break-word;
}

.system {
    color: #888;
    font-style: italic;
}

footer {
    display: flex;
    padding: 10px;
    background: #1a1a1a;
}

input {
    flex: 1;
    padding: 8px;
    font-size: 16px;
    border: none;
    outline: none;
}

button {
    padding: 8px 14px;
    margin-left: 8px;
    font-size: 16px;
    cursor: pointer;
}
</style>
</head>

<body>

<header>
    <div>ðŸŸ¢ Simple Messenger</div>
    <div id="status">ðŸ”´ offline</div>
</header>

<div id="messages"></div>

<footer>
    <input id="input" type="text" placeholder="Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ..." disabled>
    <button onclick="sendMessage()" disabled id="sendBtn">âž¤</button>
</footer>

<script>
let ws = null;
let reconnectTimer = null;

const statusEl = document.getElementById("status");
const input = document.getElementById("input");
const sendBtn = document.getElementById("sendBtn");
const messages = document.getElementById("messages");

function addMessage(text, cls = "") {
    const div = document.createElement("div");
    div.className = "message " + cls;
    div.textContent = text;
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
}

function setOnline(state) {
    if (state) {
        statusEl.textContent = "ðŸŸ¢ online";
        input.disabled = false;
        sendBtn.disabled = false;
        input.focus();
    } else {
        statusEl.textContent = "ðŸ”´ offline";
        input.disabled = true;
        sendBtn.disabled = true;
    }
}

function connect() {
    ws = new WebSocket(
        (location.protocol === "https:" ? "wss://" : "ws://") +
        location.host + "/ws"
    );

    ws.onopen = () => {
        setOnline(true);
        addMessage("Ð¡Ð¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¾", "system");
        if (reconnectTimer) {
            clearTimeout(reconnectTimer);
            reconnectTimer = null;
        }
    };

    ws.onmessage = (e) => {
        addMessage(e.data);
    };

    ws.onerror = () => {
        addMessage("ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ", "system");
    };

    ws.onclose = () => {
        setOnline(false);
        addMessage("Ð¡Ð¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ñ‚ÐµÑ€ÑÐ½Ð¾. ÐŸÐµÑ€ÐµÐ¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ...", "system");
        reconnectTimer = setTimeout(connect, 2000);
    };
}

function sendMessage() {
    if (!ws || ws.readyState !== WebSocket.OPEN) return;

    let text = input.value.trim();
    if (!text) return;

    ws.send(text);
    input.value = "";
}

input.addEventListener("keydown", e => {
    if (e.key === "Enter") sendMessage();
});

connect();
</script>

</body>
</html>

