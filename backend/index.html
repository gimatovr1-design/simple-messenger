<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Mini Chat</title>
<link rel="icon" href="/favicon.ico">

<style>
body {
  background:#020617;
  color:white;
  font-family:system-ui, sans-serif;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  margin:0;
}

#chat {
  width:320px;
  background:#020617;
  border:1px solid #1e293b;
  border-radius:14px;
  box-shadow:0 0 25px rgba(0,0,0,.6);
  overflow:hidden;
}

#header {
  display:flex;
  align-items:center;
  gap:8px;
  padding:10px;
  border-bottom:1px solid #1e293b;
}

#status {
  width:10px;
  height:10px;
  border-radius:50%;
  background:#ef4444;
  box-shadow:0 0 6px #ef4444;
  transition:.3s;
}

#status.online {
  background:#22c55e;
  box-shadow:0 0 6px #22c55e;
}

#messages {
  height:200px;
  overflow-y:auto;
  padding:10px;
  font-size:14px;
}

.msg {
  margin-bottom:6px;
}

#inputBox {
  border-top:1px solid #1e293b;
}

#msg {
  width:100%;
  padding:8px;
  background:#020617;
  color:white;
  border:none;
  outline:none;
}
</style>
</head>
<body>

<div id="chat">
  <div id="header">
    <div id="status"></div>
    <div id="statusText">Офлайн</div>
  </div>

  <div id="messages"></div>

  <div id="inputBox">
    <input id="msg" placeholder="Сообщение..." autocomplete="off">
  </div>
</div>

<script>
let nickname = localStorage.getItem("nickname");

if (!nickname) {
    nickname = prompt("Введите ник:");
    localStorage.setItem("nickname", nickname);
}
const protocol = location.protocol === "https:" ? "wss" : "ws";
const ws = new WebSocket(`${protocol}://${location.host}/ws`);

const statusDot = document.getElementById("status");
const statusText = document.getElementById("statusText");
const messages = document.getElementById("messages");

ws.onopen = () => {
    ws.send(nickname);
    statusDot.classList.add("online");
    statusText.textContent = "В сети";
};

ws.onclose = () => {
    statusDot.classList.remove("online");
    statusText.textContent = "Офлайн";
};

ws.onerror = () => {
    statusDot.classList.remove("online");
    statusText.textContent = "Офлайн";
};

ws.onmessage = (e) => {
    const d = document.createElement("div");
    d.className = "msg";
    d.textContent = e.data;
    messages.appendChild(d);
    messages.scrollTop = messages.scrollHeight;
};

document.getElementById("msg").addEventListener("keydown", e => {
    if (e.key === "Enter" && e.target.value.trim() && ws.readyState === 1) {
        ws.send(e.target.value);
        e.target.value = "";
    }
});
</script>

</body>
</html>
