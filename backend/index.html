<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Simple Messenger</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>

<h3>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —á–∞—Ç üëã</h3>

<!-- ===== –í–í–û–î –ù–ò–ö–ê ===== -->
<div id="nickBox">
    <input id="nickInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫">
    <button onclick="setNick()">OK</button>
</div>

<!-- ===== –ß–ê–¢ ===== -->
<div id="chat"></div>

<div class="inputBox">
    <input id="messageInput" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ">
    <button onclick="sendMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
</div>

<script>
let myNick = "";
let ws = new WebSocket(
    (location.protocol === "https:" ? "wss://" : "ws://") +
    location.host + "/ws"
);

ws.onmessage = (event) => {
    let data;
    try {
        data = JSON.parse(event.data);
    } catch {
        return;
    }

    // —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    if (data.type === "system") {
        addMessage(data.text, "system");
        return;
    }

    // –æ–±—ã—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    if (data.type === "message") {
        const side = data.nick === myNick ? "me" : "other";
        addMessage(`${data.nick}: ${data.text}`, side);
    }
};

function setNick() {
    const nick = document.getElementById("nickInput").value.trim();
    if (nick !== "") {
        myNick = nick;
        ws.send("/nick " + nick);
        document.getElementById("nickBox").style.display = "none";
    }
}

function sendMessage() {
    const input = document.getElementById("messageInput");
    if (input.value.trim() !== "") {
        ws.send(input.value);
        input.value = "";
    }
}

// –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ Enter
document.getElementById("messageInput").addEventListener("keydown", e => {
    if (e.key === "Enter") sendMessage();
});

function addMessage(text, type) {
    const chat = document.getElementById("chat");
    const div = document.createElement("div");
    div.className = "msg " + type;
    div.textContent = text;
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
}
</script>

</body>

<!-- ===== –°–¢–ò–õ–ò ===== -->
<style>
body {
    margin: 0;
    min-height: 100vh;
    padding: 10px;
    font-family: system-ui, sans-serif;
    color: #fff;

    background:
        linear-gradient(120deg,
            rgba(140,0,255,0.45),
            rgba(0,180,255,0.45),
            rgba(255,0,140,0.45)
        ),
        url("https://images.unsplash.com/photo-1500530855697-b586d89ba3ee");

    background-size: 300% 300%, cover;
    background-attachment: fixed;
    animation: neonMove 20s ease infinite;
}

@keyframes neonMove {
    0% { background-position: 0% 50%, center; }
    50% { background-position: 100% 50%, center; }
    100% { background-position: 0% 50%, center; }
}

#chat {
    height: 320px;
    overflow-y: auto;
    padding: 10px;
    margin-bottom: 8px;
    background: rgba(0,0,0,0.45);
    border-radius: 8px;
}

/* —Å–æ–æ–±—â–µ–Ω–∏—è */
.msg {
    max-width: 70%;
    padding: 6px 10px;
    margin-bottom: 6px;
    border-radius: 10px;
    word-wrap: break-word;
}

.msg.me {
    margin-left: auto;
    background: rgba(0, 255, 255, 0.35);
    text-align: right;
}

.msg.other {
    margin-right: auto;
    background: rgba(255, 0, 255, 0.35);
    text-align: left;
}

.msg.system {
    margin: 6px auto;
    font-size: 13px;
    opacity: 0.8;
}

.inputBox {
    display: flex;
    gap: 6px;
}

input {
    padding: 6px;
    flex: 1;
}

button {
    padding: 6px 12px;
    cursor: pointer;
}
</style>

</html>
