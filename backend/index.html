<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Simple Messenger</title>

<style>
* { box-sizing: border-box; }
body {
    margin: 0;
    height: 100vh;
    background: radial-gradient(circle at top, #1a2a3a, #050b12);
    display: flex;
    justify-content: center;
    align-items: center;
    font-family: Arial, sans-serif;
    color: #fff;
}

.chat {
    width: 820px;
    height: 520px;
    display: flex;
    background: rgba(10,15,20,0.85);
    border-radius: 12px;
    overflow: hidden;
}

.sidebar {
    width: 200px;
    background: rgba(0,0,0,0.35);
    padding: 10px;
}
.user {
    display: flex;
    gap: 8px;
    margin-bottom: 6px;
}
.dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #00ff88;
}

.main {
    flex: 1;
    display: flex;
    flex-direction: column;
}
.messages {
    flex: 1;
    padding: 12px;
    overflow-y: auto;
}
.msg {
    max-width: 60%;
    padding: 8px 10px;
    margin-bottom: 8px;
    border-radius: 10px;
}
.me { margin-left: auto; background: #7f5af0; }
.other { margin-right: auto; background: rgba(255,255,255,0.15); }
.nick { font-size: 11px; opacity: 0.7; }

.input {
    display: flex;
    gap: 6px;
    padding: 10px;
    background: rgba(0,0,0,0.35);
}
.input input {
    flex: 1;
    padding: 8px;
    border-radius: 6px;
    border: none;
}
.btn {
    width: 38px;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    background: #1f2937;
    color: #fff;
}
.send { width: 90px; background: #2563eb; }

.emoji-panel {
    position: absolute;
    bottom: 70px;
    right: 260px;
    background: #111;
    border-radius: 8px;
    padding: 8px;
    display: none;
    width: 200px;
}
</style>
</head>
<body>

<div class="chat">
    <div class="sidebar">
        <h3>ĞĞ½Ğ»Ğ°Ğ¹Ğ½</h3>
        <div id="users"></div>
    </div>

    <div class="main">
        <div class="messages" id="messages"></div>
        <div class="input">
            <button class="btn" id="emojiBtn">ğŸ˜€</button>
            <button class="btn" id="fileBtn">ğŸ“</button>
            <input type="file" id="fileInput" hidden>
            <input type="text" id="text" placeholder="Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ">
            <button class="btn send" id="send">ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ</button>
        </div>
    </div>
</div>

<div class="emoji-panel" id="emojiPanel">
ğŸ˜€ ğŸ˜ ğŸ˜‚ ğŸ¤£ ğŸ˜ ğŸ˜ ğŸ¤– ğŸ”¥ ğŸš€ ğŸ’œ ğŸ‘ ğŸ‘€ ğŸ˜¡ ğŸ˜¢ ğŸ‰
</div>

<script>
// ===== DOM =====
const users = document.getElementById("users");
const messages = document.getElementById("messages");
const text = document.getElementById("text");
const send = document.getElementById("send");
const emojiBtn = document.getElementById("emojiBtn");
const emojiPanel = document.getElementById("emojiPanel");
const fileBtn = document.getElementById("fileBtn");
const fileInput = document.getElementById("fileInput");

// ===== NICK =====
let nick = "";
while (!nick) nick = prompt("Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ½Ğ¸Ğº");

// ===== WS =====
const ws = new WebSocket(
    (location.protocol === "https:" ? "wss://" : "ws://") + location.host + "/ws"
);

ws.onopen = () => {
    ws.send(JSON.stringify({ type: "nick", nick }));
};

ws.onmessage = e => {
    const data = JSON.parse(e.data);

    if (data.type === "users") {
        users.innerHTML = "";
        data.users.forEach(u => {
            users.innerHTML += `
                <div class="user">
                    <span class="dot"></span>${u}
                </div>`;
        });
    }

    if (data.type === "message") {
        addMsg(data.nick, data.text);
    }

    if (data.type === "file") {
        if (data.mime.startsWith("image"))
            addMsg(data.nick, `<img src="${data.content}" style="max-width:200px">`);
        else if (data.mime.startsWith("video"))
            addMsg(data.nick, `<video controls src="${data.content}" style="max-width:200px"></video>`);
        else
            addMsg(data.nick, `<a href="${data.content}" download="${data.name}">ğŸ“ ${data.name}</a>`);
    }
};

function addMsg(from, html) {
    const div = document.createElement("div");
    div.className = "msg " + (from === nick ? "me" : "other");
    div.innerHTML = `<div class="nick">${from}</div>${html}`;
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
}

// ===== SEND =====
function sendMsg() {
    if (!text.value.trim()) return;
    ws.send(JSON.stringify({ type: "message", text: text.value }));
    text.value = "";
}

send.onclick = sendMsg;
text.onkeydown = e => e.key === "Enter" && sendMsg();

// ===== EMOJI =====
emojiBtn.onclick = () => {
    emojiPanel.style.display =
        emojiPanel.style.display === "block" ? "none" : "block";
};
emojiPanel.onclick = e => {
    if (e.target.nodeType === 3) text.value += e.target.textContent.trim();
};

// ===== FILE =====
fileBtn.onclick = () => fileInput.click();
fileInput.onchange = () => {
    const f = fileInput.files[0];
    const r = new FileReader();
    r.onload = () => {
        ws.send(JSON.stringify({
            type: "file",
            name: f.name,
            mime: f.type,
            content: r.result
        }));
    };
    r.readAsDataURL(f);
};
</script>
</body>
</html>

